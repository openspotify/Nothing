name: 🔁 Replit Pinger

on:
  schedule:
    - cron: "* * * * *"  # ⏰ Every minute
  workflow_dispatch:     # 🖱️ Optional: Manual trigger

jobs:
  ping-replit:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout repo
        uses: actions/checkout@v3

      - name: 🔁 Loop ping to Replit (every 5s for 1 min)
        run: |
          mkdir -p logs
          echo "📅 Log started at $(date)" >> logs/ping-logs.txt
          for i in {1..60}
          do
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://240a81b0-7fc0-4b2f-9a81-75a2ad07195b-00-3grvtt2u4ccmw.pike.replit.dev/)
            echo "[$(date '+%T')] Ping $i => Status: $STATUS" >> logs/ping-logs.txt
            sleep 5
          done
          echo "✅ Log ended at $(date)" >> logs/ping-logs.txt

           - name: 📦 Commit and Push Logs
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          git config --global user.name "Replit Bot"
          git config --global user.email "replitbot@users.noreply.github.com"
          git add logs/
          git commit -m "📄 Log ping $(date '+%Y-%m-%d %H:%M:%S')" || echo "🪵 Nothing to commit"
          git push https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }} HEAD:main || echo "⬆️ Push failed"
